{
  "id": "c7742c40-6805-4578-a61e-1aa9a687fe17",
  "prefix": "GetRowsChangedQuickly",
  "description": "Get Rows Changed For Inserted or Deleted Only But Not UseFul for Updated Rows",
  "body": "/* =====================================================================================================================\r\n-- Script\t\t: GetRowsChangedQuickly\r\n-- Description\t: Get Rows Changed For Inserted or Deleted Only But Not UseFul for Updated Rows\r\n-- Usage\t\t: Set 1 = 0 To ReUse the #InitialRows | Set 1 = 1 To ReCollect #InitialRows\r\n===================================================================================================================== */\r\n--$BeginRegion: Reset #InitialRows Collected\r\nIF 1 = 0 --Set 1 = 1 To ReCollect #InitialRows\r\n\tIF OBJECT_ID('tempdb..#InitialRows', 'U') IS NOT NULL DROP TABLE #InitialRows;\r\n--$EndRegion: Reset #InitialRows Collected\r\n--\r\n--$BeginRegion: Collecting #InitialRows\r\nIF OBJECT_ID('tempdb..#InitialRows', 'U') IS NULL\r\nBEGIN\r\n\tSELECT OBJECT_SCHEMA_NAME(P.object_id) AS \"SchName\", OBJECT_NAME(P.object_id) AS \"TblName\", P.rows AS \"Rows\"\r\n\tINTO #InitialRows\r\n\tFROM sys.partitions AS P\r\n\tWHERE OBJECTPROPERTY(P.object_id, 'IsUserTable') = 1\r\n\tGROUP BY P.object_id, Rows\r\n\tORDER BY SchName ASC, TblName ASC;\r\nEND;\r\n--$EndRegion: Collecting #InitialRows\r\n--\r\n--$BeginRegion: Collecting #FinalRows\r\nIF OBJECT_ID('tempdb..#FinalRows', 'U') IS NOT NULL DROP TABLE #FinalRows;\r\nBEGIN\r\n\tSELECT OBJECT_SCHEMA_NAME(P.object_id) AS \"SchName\", OBJECT_NAME(P.object_id) AS \"TblName\", P.rows AS \"Rows\"\r\n\tINTO #FinalRows\r\n\tFROM sys.partitions AS P\r\n\tWHERE OBJECTPROPERTY(P.object_id, 'IsUserTable') = 1\r\n\tGROUP BY P.object_id, Rows\r\n\tORDER BY SchName ASC, TblName ASC;\r\nEND;\r\n--$EndRegion: Collecting #FinalRows\r\n--\r\nSELECT ISNULL(IR.SchName, FR.SchName) AS \"SchName\", ISNULL(IR.TblName, FR.TblName) AS \"TblName\", IR.Rows, FR.Rows\r\nFROM #InitialRows AS IR\r\nFULL OUTER JOIN #FinalRows AS FR ON FR.SchName = IR.SchName AND FR.TblName = IR.TblName\r\nWHERE ISNULL(IR.Rows, 0) <> ISNULL(FR.Rows, 0)\r\n\tAND ISNULL(IR.SchName, FR.SchName) NOT LIKE ''\r\n\tAND ISNULL(IR.TblName, FR.TblName) NOT LIKE '';"
}