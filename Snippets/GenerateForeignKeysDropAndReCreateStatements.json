{
  "id": "21ec0ccb-204c-4678-add8-14db69aa31e0",
  "prefix": "GenerateForeignKeysDropAndReCreateStatements",
  "description": "To Generate Drop and ReCreate Statements of ALL Foreign Keys in a Given Database",
  "body": "/* =================================================================================================\r\n-- Script\t\t: Generate_ForeignKey_Constraints_Drop_And_Create_Statements.sql\r\n-- Description\t: To Generate Drop and Create Statements for ALL Foreign Keys Constraints.\r\n-- Server\t\t: LOCALSERVER\r\n-- Database\t\t: USER Database\r\n================================================================================================= */\r\nSELECT --\r\n\tFK.NAME AS CONSTRAINT_NAME,\r\n\t--$BeginRegion: Generate Drop Foreign Keys Statements\r\n\t'ALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME(FK.parent_object_id)) + '.' + QUOTENAME(OBJECT_NAME(FK.parent_object_id)) \r\n\t\t+ ' DROP CONSTRAINT ' + QUOTENAME(FK.NAME) + ';' AS \"DROP_CONSTRAINT_STATEMENT\",\r\n\t--$EndRegion: Generate Drop Foreign Keys Statements\r\n\t--\r\n\t--$BeginRegion: Generate ReCreate Foreign Keys Statements\r\n\t'ALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME(FK.parent_object_id)) + '.' + QUOTENAME(OBJECT_NAME(FK.parent_object_id)) \r\n\t\t+ ' WITH CHECK ADD CONSTRAINT ' + QUOTENAME(OBJECT_NAME(FK.object_id)) \r\n\t\t+ ' FOREIGN KEY'\r\n\t\t+ ' (' + STUFF((SELECT ', ' + QUOTENAME(C.NAME)\r\n\t\t\tFROM sys.columns AS c\r\n\t\t\tINNER JOIN sys.foreign_key_columns AS KC ON C.object_id = KC.parent_object_id\r\n\t\t\t\tAND C.column_id = KC.parent_column_id\r\n\t\t\tWHERE KC.constraint_object_id = FK.object_id\r\n\t\t\tORDER BY KC.constraint_column_id\r\n\t\t\tFOR XML PATH('')), 1, 1, '') + ' )'\r\n\t\t+ ' REFERENCES ' + QUOTENAME(OBJECT_SCHEMA_NAME(FK.referenced_object_id)) + '.' + QUOTENAME(OBJECT_NAME(FK.referenced_object_id)) \r\n\t\t+ ' (' + STUFF((SELECT ', ' + QUOTENAME(C.NAME)\r\n\t\t\tFROM sys.columns AS c\r\n\t\t\tINNER JOIN sys.foreign_key_columns AS KC ON C.object_id = KC.referenced_object_id\r\n\t\t\t\tAND C.column_id = KC.referenced_column_id\r\n\t\t\tWHERE KC.constraint_object_id = FK.object_id\r\n\t\t\tORDER BY KC.constraint_column_id\r\n\t\t\tFOR XML PATH('')), 1, 1, '') + ' )' \r\n\t\t+ CASE FK.delete_referential_action\r\n\t\t\tWHEN 0 THEN ''\r\n\t\t\t\tELSE ' ON DELETE ' + REPLACE(FK.delete_referential_action_desc, '_', ' ')\r\n\t\t\t\tEND \r\n\t\t+ CASE FK.update_referential_action\r\n\t\t\tWHEN 0 THEN ''\r\n\t\t\t\tELSE ' ON UPDATE ' + REPLACE(FK.update_referential_action_desc, '_', ' ')\r\n\t\t\t\tEND \r\n\t\t+ CASE FK.is_not_for_replication\r\n\t\t\tWHEN 0 THEN ''\r\n\t\t\t\tELSE ' NOT FOR REPLICATION'\r\n\t\t\t\tEND \r\n\t\t+ ';' AS \"RECREATE_CONSTRAINT_STATEMENT\"\r\n\t--$EndRegion: Generate ReCreate Foreign Keys Statements\r\nFROM sys.foreign_keys AS FK\r\nWHERE FK.is_ms_shipped = 0\r\nORDER BY OBJECT_SCHEMA_NAME(FK.parent_object_id), OBJECT_NAME(FK.parent_object_id), FK.name ASC;"
}