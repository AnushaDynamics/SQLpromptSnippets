{
  "id": "21ec0ccb-204c-4678-add8-14db69aa31e0",
  "prefix": "GenerateForeignKeysDropAndReCreateStatements",
  "description": "To Generate Drop and ReCreate Statements of ALL Foreign Keys in a Given Database",
  "body": "/* =================================================================================================\r\n-- Script\t\t: Generate_ForeignKey_Constraints_Drop_And_Create_Statements.sql\r\n-- Description\t: To Generate Drop and Create Statements of ALL Foreign Keys in a Given Database\r\n-- Server\t\t: LOCALSERVER\r\n-- Database\t\t: USER Database\r\n================================================================================================= */\r\nSELECT --\r\n\tFK.name AS \"ConstraintName\",\r\n\tFK.type_desc AS \"ContraintType\",\r\n\t'|' AS \"||\",\r\n\tOBJECT_SCHEMA_NAME(FK.parent_object_id) AS \"ParentSchemaName\",\r\n\tOBJECT_NAME(FK.parent_object_id) AS \"ParentTableName\",\r\n\tSTUFF((\r\n\t\t\t  SELECT ', ' + c.name\r\n\t\t\t  FROM sys.columns AS c\r\n\t\t\t  INNER JOIN sys.foreign_key_columns AS kc\r\n\t\t\t\t  ON c.object_id = kc.parent_object_id\r\n\t\t\t\t\t AND c.column_id = kc.parent_column_id\r\n\t\t\t  WHERE kc.constraint_object_id = FK.object_id\r\n\t\t\t  ORDER BY kc.constraint_column_id\r\n\t\t\t  FOR XML PATH('')), 1, 1, ''\r\n\t\t ) AS \"ParentConstraintColumns\",\r\n\t'=>' AS \" =>\",\r\n\tOBJECT_SCHEMA_NAME(FK.referenced_object_id) AS \"ReferencedSchemaName\",\r\n\tOBJECT_NAME(FK.referenced_object_id) AS \"ReferencedTableName\",\r\n\tSTUFF((\r\n\t\t\t  SELECT ', ' + c.name\r\n\t\t\t  FROM sys.columns AS c\r\n\t\t\t  INNER JOIN sys.foreign_key_columns AS kc\r\n\t\t\t\t  ON c.object_id = kc.referenced_object_id\r\n\t\t\t\t\t AND c.column_id = kc.referenced_column_id\r\n\t\t\t  WHERE kc.constraint_object_id = FK.object_id\r\n\t\t\t  ORDER BY kc.constraint_column_id\r\n\t\t\t  FOR XML PATH('')), 1, 1, ''\r\n\t\t ) AS \"ReferencedConstraintColumns\",\r\n\t'|' AS \"||\",\r\n\tFK.delete_referential_action_desc AS \"OnDelete?\",\r\n\tFK.update_referential_action_desc AS \"OnUpdate?\",\r\n\t'|' AS \"||\",\r\n\t'ALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME(FK.parent_object_id)) + '.' + QUOTENAME(OBJECT_NAME(FK.parent_object_id)) \r\n\t\t+ ' DROP CONSTRAINT ' + QUOTENAME(FK.NAME) + ';' AS \"DropConstraintStatement\",\r\n\t--\r\n\t'ALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME(FK.parent_object_id)) + '.' + QUOTENAME(OBJECT_NAME(FK.parent_object_id)) \r\n\t\t+ ' WITH CHECK ADD CONSTRAINT ' + QUOTENAME(OBJECT_NAME(FK.object_id)) \r\n\t\t+ ' FOREIGN KEY'\r\n\t\t+ ' (' + STUFF((SELECT ', ' + QUOTENAME(c.NAME)\r\n\t\t\tFROM sys.columns AS c\r\n\t\t\tINNER JOIN sys.foreign_key_columns AS kc ON c.object_id = kc.parent_object_id\r\n\t\t\t\tAND c.column_id = kc.parent_column_id\r\n\t\t\tWHERE kc.constraint_object_id = FK.object_id\r\n\t\t\tORDER BY kc.constraint_column_id\r\n\t\t\tFOR XML PATH('')\r\n\t\t\t), 1, 1, '') + ')'\r\n\t\t+ ' REFERENCES ' + QUOTENAME(OBJECT_SCHEMA_NAME(FK.referenced_object_id)) + '.' + QUOTENAME(OBJECT_NAME(FK.referenced_object_id)) \r\n\t\t+ ' (' + STUFF((SELECT ', ' + QUOTENAME(c.NAME)\r\n\t\t\tFROM sys.columns AS c\r\n\t\t\tINNER JOIN sys.foreign_key_columns AS kc ON c.object_id = kc.referenced_object_id\r\n\t\t\t\tAND c.column_id = kc.referenced_column_id\r\n\t\t\tWHERE kc.constraint_object_id = FK.object_id\r\n\t\t\tORDER BY kc.constraint_column_id\r\n\t\t\tFOR XML PATH('')\r\n\t\t\t), 1, 1, '') + ')' \r\n\t\t+ CASE FK.delete_referential_action\r\n\t\t\tWHEN 0 THEN ''\r\n\t\t\t\tELSE ' ON DELETE ' + REPLACE(FK.delete_referential_action_desc, '_', ' ')\r\n\t\t\t\tEND \r\n\t\t+ CASE FK.update_referential_action\r\n\t\t\tWHEN 0 THEN ''\r\n\t\t\t\tELSE ' ON UPDATE ' + REPLACE(FK.update_referential_action_desc, '_', ' ')\r\n\t\t\t\tEND \r\n\t\t+ CASE FK.is_not_for_replication\r\n\t\t\tWHEN 0 THEN ''\r\n\t\t\t\tELSE ' NOT FOR REPLICATION'\r\n\t\t\t\tEND \r\n\t\t+ ';' AS \"ReCreateConstraintStatement\"\r\n--\r\nFROM sys.foreign_keys AS FK\r\nWHERE FK.is_ms_shipped = 0\r\nORDER BY OBJECT_SCHEMA_NAME(FK.parent_object_id),\r\n\t\t OBJECT_NAME(FK.parent_object_id),\r\n\t\t FK.name ASC;"
}