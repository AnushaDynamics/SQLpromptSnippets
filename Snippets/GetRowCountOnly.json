{
  "id": "06c61315-3060-4d71-b426-fa5461e25512",
  "prefix": "GetRowCountOnly",
  "description": "Get Row Count and Size for Each Table",
  "body": "/* =============================================================================================================================================================\r\n-- Server\t\t: LOCAL SERVER\r\n-- Database\t\t: USER DATABASE\r\n-- Script\t\t: GetRowCountOnly\r\n-- Description\t: Get Row Count and Size for Each Table\r\n-- Refer Links\t: https://techyaz.com/sql-server/get-row-counts-tables-database/\r\n============================================================================================================================================================= */\r\nDECLARE @SCHname VARCHAR(128) = '$SchName$'; SET @SCHname = LTRIM(RTRIM(@SCHname)); IF @SCHname = '' SET @SCHname = NULL; --Optional\r\nDECLARE @TBLname VARCHAR(128) = '$TblName$'; SET @TBLname = LTRIM(RTRIM(@TBLname)); IF @TBLname = '' SET @TBLname = NULL; --Optional\r\n\r\n--\r\n--$BeginRegion: Get Only Row Counts for Each Table\r\nSELECT OBJECT_SCHEMA_NAME(PS.object_id) AS \"SchemaName\",\r\n\t   OBJECT_NAME(PS.object_id) AS \"TableName\",\r\n\t   SUM(PS.row_count) AS \"Rows\"\r\nFROM sys.dm_db_partition_stats AS PS\r\nWHERE PS.index_id < 2 --{ = 0 : Heap | = 1 : Clustered Index | >= 2 : NonClustered Index}\r\n\t  AND OBJECTPROPERTY(PS.object_id, 'IsUserTable') = 1\r\n\t  AND (OBJECT_SCHEMA_NAME(PS.object_id) = @SCHname OR @SCHname IS NULL)\r\n\t  AND (OBJECT_NAME(PS.object_id) = @TBLname OR @TBLname IS NULL)\r\nGROUP BY PS.object_id\r\n--HAVING SUM(row_count) > 0 --UnComment To Hide Empty Tables\r\nORDER BY \r\n\t--SchemaName ASC, TableName ASC;\r\n\tSUM(PS.row_count) DESC;\r\n--$EndRegion: Get Only Row Counts for Each Table\r\n\r\n--\r\n--$BeginRegion: Get Row Counts and Size Allocated for Each Table\r\nSELECT OBJECT_SCHEMA_NAME(P.object_id) AS \"SchemaName\",\r\n\t   OBJECT_NAME(P.object_id) AS \"TableName\",\r\n\t   P.rows AS \"Rows\",\r\n\t   CAST(ROUND(((SUM(AU.total_pages) * 8) / 1024.00), 2) AS NUMERIC(36, 2)) AS \"Reserved(MB)\",\r\n\t   CAST(ROUND(((SUM(AU.used_pages) * 8) / 1024.00), 2) AS NUMERIC(36, 2)) AS \"Used(MB)\",\r\n\t   CAST(ROUND(((SUM(AU.total_pages) - SUM(AU.used_pages)) * 8) / 1024.00, 2) AS NUMERIC(36, 2)) AS \"UnUsed(MB)\"\r\nFROM sys.partitions AS P\r\nINNER JOIN sys.allocation_units AS AU ON P.partition_id = AU.container_id\r\nWHERE P.index_id <= 2 --{ = 0 : Heap | = 1 : Clustered Index | >= 2 : NonClustered Index}\r\n\t  AND OBJECTPROPERTY(P.object_id, 'IsUserTable') = 1 --To Consider Only User Created Tables\r\n\t  AND (OBJECT_SCHEMA_NAME(P.object_id) = @SCHname OR @SCHname IS NULL)\r\n\t  AND (OBJECT_NAME(P.object_id) = @TBLname OR @TBLname IS NULL)\r\nGROUP BY P.object_id, P.rows\r\n--HAVING P.rows > 0 --UnComment To Hide Empty Tables\r\nORDER BY \r\n\t--SchemaName ASC, TableName ASC;\r\n\tP.rows DESC;\r\n--$EndRegion: Get Row Counts and Size Allocated for Each Table\r\n\r\n--\r\n--$BeginRegion: Get TableSpace using sp_spaceused\r\n----sp_spaceused DoesNot Return the SchemaName (sp_spaceused is not used mostly)\r\nDECLARE @TableSize TABLE \r\n(\r\n\tname NVARCHAR(128) NOT NULL,\r\n\trows CHAR(20) NOT NULL,\r\n\treserved VARCHAR(18) NOT NULL,\r\n\tdata VARCHAR(18) NOT NULL,\r\n\tindex_size VARCHAR(18) NOT NULL,\r\n\tunused VARCHAR(18) NOT NULL\r\n);\r\n--\r\nINSERT INTO @TableSize \r\nEXEC sys.sp_MSforeachtable @command1 = \"EXEC sp_spaceused '?'\";\r\nSELECT TS.name, TS.rows, TS.reserved, TS.data, TS.index_size, TS.unused\r\nFROM @TableSize AS TS\r\nWHERE 1 = 1\r\n\t  AND (TS.name = @TBLname OR @TBLname IS NULL);\r\n--$EndRegion: Get TableSpace using sp_spaceused",
  "placeholders": [
    {
      "name": "SchName",
      "defaultValue": " "
    },
    {
      "name": "TblName",
      "defaultValue": " "
    }
  ]
}