{
  "id": "080a0c93-9621-48f4-866d-00cd98266316",
  "prefix": "GetAllConstraints_PK_FK_UK_CK_with_Drop_ReCreate_Statements",
  "description": "To Get Details of All Constraints like PK, FK, UK, CK etc and Generate Constraint Drop and ReCreate Statements",
  "body": "/* =============================================================================================================================================================\r\n-- Server\t\t: LOCAL SERVER\r\n-- Database\t\t: USER DATABASE\r\n-- Script\t\t: GetAllConstraints_PK_FK_UK_CK_with_Drop_ReCreate_Statements\r\n-- Description\t: To Get Details of All Constraints like 'PRIMARY_KEY_CONSTRAINT', 'FOREIGN_KEY_CONSTRAINT', 'UNIQUE_CONSTRAINT', 'CHECK_CONSTRAINT'\r\n\t\t\t\t  Retrives All Complex Relations like Composite Primary Keys, Foreign Keys And Respective Columns with CASCADE.\r\n\t\t\t\t  Generate Drop and Create Scripts for the Constraints.\r\n-- Usage\t\t: Provide Parameters in Filters If Required\r\n\t\t\t\t\tCONSTRAINT_TYPE == { PRIMARY_KEY_CONSTRAINT | FOREIGN_KEY_CONSTRAINT | UNIQUE_CONSTRAINT | CHECK_CONSTRAINT }\r\n\t\t\t\t\t[OnDelete?] == { NO_ACTION | CASCADE | SET_NULL | SET_DEFAULT }\r\n\t\t\t\t\t[OnUpdate?] == { NO_ACTION | CASCADE | SET_NULL | SET_DEFAULT }\r\n\t\t\t\t\t[IS_ENABLED?] == { YES | NO }\r\n\t\t\t\t\t[IS_TRUSTED?] == { YES | NO }\r\n-- Refer Links\t:\r\n============================================================================================================================================================= */\r\nDECLARE @ConstraintName NVARCHAR(128) = N'$ConstraintName$'; SET @ConstraintName=LTRIM(RTRIM(@ConstraintName)); IF @ConstraintName='' SET @ConstraintName=NULL;\r\nDECLARE @ConstraintType NVARCHAR(128) = N'$ConstraintType$'; SET @ConstraintType=LTRIM(RTRIM(@ConstraintType)); IF @ConstraintType='' SET @ConstraintType=NULL;\r\nDECLARE @MainTableSchema NVARCHAR(128) = N'$MainTableSchema$'; SET @MainTableSchema=LTRIM(RTRIM(@MainTableSchema)); IF @MainTableSchema='' SET @MainTableSchema=NULL;\r\nDECLARE @MainTableName NVARCHAR(128) = N'$MainTableName$'; SET @MainTableName=LTRIM(RTRIM(@MainTableName)); IF @MainTableName='' SET @MainTableName=NULL;\r\nDECLARE @MainTableColumns NVARCHAR(128) = N'$MainTableColumns$'; SET @MainTableColumns=LTRIM(RTRIM(@MainTableColumns)); IF @MainTableColumns='' SET @MainTableColumns=NULL;\r\nDECLARE @ReferTableSchema NVARCHAR(128) = N'$ReferTableSchema$'; SET @ReferTableSchema=LTRIM(RTRIM(@ReferTableSchema)); IF @ReferTableSchema='' SET @ReferTableSchema=NULL;\r\nDECLARE @ReferTableName NVARCHAR(128) = N'$ReferTableName$'; SET @ReferTableName=LTRIM(RTRIM(@ReferTableName)); IF @ReferTableName='' SET @ReferTableName=NULL;\r\nDECLARE @ReferTableColumns NVARCHAR(128) = N'$ReferTableColumns$'; SET @ReferTableColumns=LTRIM(RTRIM(@ReferTableColumns)); IF @ReferTableColumns='' SET @ReferTableColumns=NULL;\r\nDECLARE @Ondelete NVARCHAR(128) = N'$Ondelete$'; SET @Ondelete=LTRIM(RTRIM(@Ondelete)); IF @Ondelete='' SET @Ondelete=NULL;\r\nDECLARE @Onupdate NVARCHAR(128) = N'$Onupdate$'; SET @Onupdate=LTRIM(RTRIM(@Onupdate)); IF @Onupdate='' SET @Onupdate=NULL;\r\nDECLARE @IsEnabled NVARCHAR(128) = N'$IsEnabled$'; SET @IsEnabled=LTRIM(RTRIM(@IsEnabled)); IF @IsEnabled='' SET @IsEnabled=NULL;\r\nDECLARE @IsTrusted NVARCHAR(128) = N'$IsTrusted$'; SET @IsTrusted=LTRIM(RTRIM(@IsTrusted)); IF @IsTrusted='' SET @IsTrusted=NULL;\r\n--\r\nSELECT --\r\n\tCTE.CONSTRAINT_NAME,\r\n\tCTE.CONSTRAINT_TYPE,\r\n\tREPLACE(ISNULL(CTE.[ON_DELETE?], ''), 'NO_ACTION', '') AS \"ON_DELETE?\",\r\n\tREPLACE(ISNULL(CTE.[ON_UPDATE?], ''), 'NO_ACTION', '') AS \"ON_UPDATE?\",\r\n\tISNULL(CTE.[IS_ENABLED?], '') AS \"IS_ENABLED?\",\r\n\tISNULL(CTE.[IS_TRUSTED?], '') AS \"IS_TRUSTED?\",\r\n\t'|' AS \"||\",\r\n\tCTE.MAIN_TABLE_SCHEMA,\r\n\tCTE.MAIN_TABLE_NAME,\r\n\tCASE CTE.CONSTRAINT_TYPE\r\n\t\tWHEN 'PRIMARY_KEY_CONSTRAINT' THEN 'PK: ' + CASE WHEN (CHARINDEX(',', CTE.MAIN_TABLE_COLUMNS) > 0) THEN '( ' + CTE.MAIN_TABLE_COLUMNS + ' )' ELSE CTE.MAIN_TABLE_COLUMNS END\r\n\t\tWHEN 'FOREIGN_KEY_CONSTRAINT' THEN 'FK: ' + CASE WHEN (CHARINDEX(',', CTE.MAIN_TABLE_COLUMNS) > 0) THEN '( ' + CTE.MAIN_TABLE_COLUMNS + ' )' ELSE CTE.MAIN_TABLE_COLUMNS END\r\n\t\tWHEN 'UNIQUE_CONSTRAINT' THEN 'UK: ' + CASE WHEN (CHARINDEX(',', CTE.MAIN_TABLE_COLUMNS) > 0) THEN '( ' + CTE.MAIN_TABLE_COLUMNS + ' )' ELSE CTE.MAIN_TABLE_COLUMNS END\r\n\t\tWHEN 'CHECK_CONSTRAINT' THEN 'CK: ' + CTE.MAIN_TABLE_COLUMNS\r\n\t\tELSE ''\r\n\t\tEND AS \"MAIN_TABLE_COLUMNS\",\r\n\tCASE WHEN (CTE.CONSTRAINT_TYPE = 'FOREIGN_KEY_CONSTRAINT') THEN '=>' ELSE '  |' END AS \"=>\",\r\n\tISNULL(CTE.REFER_TABLE_SCHEMA, '') AS REFER_TABLE_SCHEMA,\r\n\tISNULL(CTE.REFER_TABLE_NAME, '') AS REFER_TABLE_NAME,\r\n\tISNULL('PK: ' + CASE WHEN (CHARINDEX(',', CTE.REFER_TABLE_COLUMNS) > 0) THEN '( ' + CTE.REFER_TABLE_COLUMNS + ' )' ELSE CTE.REFER_TABLE_COLUMNS END, '') AS \"REFER_TABLE_COLUMNS\",\r\n\t'|' AS \"|||\",\r\n\tISNULL(CASE CTE.CONSTRAINT_TYPE\r\n\t\t\tWHEN 'FOREIGN_KEY_CONSTRAINT'\r\n\t\t\t\tTHEN 'FK:: Columns \" ' + CTE.MAIN_TABLE_COLUMNS + ' \" in Table \" ' + CTE.MAIN_TABLE_SCHEMA + '.' + CTE.MAIN_TABLE_NAME + ' \"'\r\n\t\t\t\t\t+ ' => REFERENCES => ' + 'PK:: Columns \" ' + CTE.REFER_TABLE_COLUMNS + ' \" in Table \" ' + CTE.REFER_TABLE_SCHEMA + '.' + CTE.REFER_TABLE_NAME + ' \"'\r\n\t\t\tELSE NULL\r\n\t\t\tEND, '') AS \"PRIMARYKEY_FOREIGNKEY_NOTATION\",\r\n\tISNULL(CTE.DROP_CONSTRAINT_STATEMENT, '') AS DROP_CONSTRAINT_STATEMENT,\r\n\tISNULL(CTE.RECREATE_CONSTRAINT_STATEMENT, '') AS RECREATE_CONSTRAINT_STATEMENT\r\nFROM\r\n(\r\n\t--$BeginRegion: PrimaryKey Constraints and UniqueKey Constraints\r\n\tSELECT --\r\n\t\t--$BeginRegion: Get PrimaryKey Constraints and UniqueKey Constraints\r\n\t\tKC.name AS CONSTRAINT_NAME,\r\n\t\tKC.type_desc AS CONSTRAINT_TYPE,\r\n\t\tNULL AS \"ON_UPDATE?\",\r\n\t\tNULL AS \"ON_DELETE?\",\r\n\t\tNULL AS \"IS_ENABLED?\",\r\n\t\tNULL AS \"IS_TRUSTED?\",\r\n\t\t--'|' AS \"||\",\r\n\t\tOBJECT_SCHEMA_NAME(KC.parent_object_id) AS MAIN_TABLE_SCHEMA,\r\n\t\tOBJECT_NAME(KC.parent_object_id) AS MAIN_TABLE_NAME,\r\n\t\tSTUFF((SELECT ', ' + C.name\r\n\t\t\t\tFROM sys.columns AS C\r\n\t\t\t\tINNER JOIN sys.index_columns AS IC ON IC.object_id = C.object_id AND IC.column_id = C.column_id\r\n\t\t\t\tWHERE C.object_id = KC.parent_object_id AND IC.index_id = KC.unique_index_id\r\n\t\t\t\tORDER BY IC.key_ordinal ASC FOR XML PATH('')), 1, 2, '') AS MAIN_TABLE_COLUMNS,\r\n\t\t--'' AS \"=>\",\r\n\t\tNULL AS REFER_TABLE_SCHEMA,\r\n\t\tNULL AS REFER_TABLE_NAME,\r\n\t\tNULL AS REFER_TABLE_COLUMNS,\r\n\t\t--$EndRegion: Get PrimaryKey Constraints and UniqueKey Constraints\r\n\t\t--'|' AS \"|||\",\r\n\t\t--$BeginRegion: Generate PrimaryKey Constraint or UniqueKey Constraint Drop Statements\r\n\t\t'IF OBJECT_ID(''' + QUOTENAME(OBJECT_SCHEMA_NAME(KC.object_id)) + '.' + QUOTENAME(KC.name) + ''', ''' + KC.type COLLATE DATABASE_DEFAULT + ''') IS NOT NULL'\r\n\t\t\t+ ' ALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME(KC.parent_object_id)) + '.' + QUOTENAME(OBJECT_NAME(KC.parent_object_id))\r\n\t\t\t+ ' DROP CONSTRAINT ' + QUOTENAME(KC.name) --QUOTENAME(OBJECT_NAME(KC.object_id))\r\n\t\t\t+ ';'\r\n\t\t\tAS \"DROP_CONSTRAINT_STATEMENT\",\r\n\t\t--$EndRegion: Generate PrimaryKey Constraint or UniqueKey Constraint Drop Statements\r\n\t\t--\r\n\t\t--$BeginRegion: Generate PrimaryKey Constraint or UniqueKey Constraint ReCreate Statements\r\n\t\t'IF OBJECT_ID(''' + QUOTENAME(OBJECT_SCHEMA_NAME(KC.object_id)) + '.' + QUOTENAME(KC.name) + ''', ''' + KC.type COLLATE DATABASE_DEFAULT + ''') IS NULL'\r\n\t\t\t+ ' BEGIN'\r\n\t\t\t\t+ ' ALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME(KC.parent_object_id)) + '.' + QUOTENAME(OBJECT_NAME(KC.parent_object_id))\r\n\t\t\t\t+ ' ADD CONSTRAINT ' + QUOTENAME(KC.name) --QUOTENAME(OBJECT_NAME(KC.object_id))\r\n\t\t\t\t+ CASE WHEN KC.type = 'PK' THEN ' PRIMARY KEY' WHEN KC.type = 'UQ' THEN ' UNIQUE' ELSE '' END \r\n\t\t\t\t+ ' ' + (SELECT TOP(1) I.type_desc FROM sys.indexes AS I WHERE I.object_id = KC.parent_object_id AND I.name = KC.name ORDER BY I.type_desc)\r\n\t\t\t\t+ ' (' + STUFF((SELECT ', ' + QUOTENAME(C.name) + CASE WHEN IC.is_descending_key = 1 THEN ' DESC' ELSE ' ASC' END\r\n\t\t\t\t\t\t\t\tFROM sys.columns AS C\r\n\t\t\t\t\t\t\t\tINNER JOIN sys.index_columns AS IC ON IC.object_id = C.object_id AND IC.column_id = C.column_id\r\n\t\t\t\t\t\t\t\tWHERE C.object_id = KC.parent_object_id AND IC.index_id = KC.unique_index_id\r\n\t\t\t\t\t\t\t\tORDER BY IC.key_ordinal ASC FOR XML PATH('')), 1, 1, '') + ' )'\r\n\t\t\t\t+ ' WITH (' + (SELECT TOP(1) ('PAD_INDEX = ' + CASE WHEN I.is_padded = 1 THEN 'ON' ELSE 'OFF' END\r\n\t\t\t\t\t\t\t\t+ ', ALLOW_PAGE_LOCKS = ' + CASE WHEN I.allow_page_locks = 1 THEN 'ON' ELSE 'OFF' END\r\n\t\t\t\t\t\t\t\t+ ', ALLOW_ROW_LOCKS = ' + CASE WHEN I.allow_row_locks = 1 THEN 'ON' ELSE 'OFF' END\r\n\t\t\t\t\t\t\t\t+ ', STATISTICS_NORECOMPUTE = ' + CASE WHEN INDEXPROPERTY(I.object_id, I.name, 'IsStatistics') = 1 THEN 'ON' ELSE 'OFF' END\r\n\t\t\t\t\t\t\t\t+ ', IGNORE_DUP_KEY = ' + CASE WHEN I.ignore_dup_key = 1 THEN 'ON' ELSE 'OFF' END\r\n\t\t\t\t\t\t\t\t+ CASE WHEN I.fill_factor > 0 THEN ', FILLFACTOR = ' + CAST(I.fill_factor AS VARCHAR(3)) ELSE '' END + ');')\r\n\t\t\t\t\t\t\t\tFROM sys.indexes AS I WHERE I.object_id = KC.parent_object_id AND I.name = KC.name ORDER BY I.type_desc)\r\n\t\t\t+ ' END'\r\n\t\t\t+ ';'\r\n\t\t\tAS \"RECREATE_CONSTRAINT_STATEMENT\"\r\n\t\t--$EndRegion: Generate Primary Key Constraint or Unique Key Constraint ReCreate Statements\r\n\tFROM sys.key_constraints AS KC\r\n\tWHERE OBJECTPROPERTYEX(KC.parent_object_id, 'BaseType') = 'U'\r\n\t--$EndRegion: PrimaryKey Constraints and UniqueKey Constraints\r\n\tUNION ALL\r\n\t--$BeginRegion: Check Constraints\r\n\tSELECT --\r\n\t\t--$BeginRegion: Get Check Constraints\r\n\t\tCC.name AS \"CONSTRAINT_NAME\",\r\n\t\tCC.type_desc AS \"CONSTRAINT_TYPE\",\r\n\t\t--'|' AS \"||\",\r\n\t\tNULL AS \"ON_UPDATE?\",\r\n\t\tNULL AS \"ON_DELETE?\",\r\n\t\tNULL AS \"IS_ENABLED?\",\r\n\t\tNULL AS \"IS_TRUSTED?\",\r\n\t\tOBJECT_SCHEMA_NAME(CC.parent_object_id) AS \"MAIN_TABLE_SCHEMA\",\r\n\t\tOBJECT_NAME(CC.parent_object_id) AS \"MAIN_TABLE_NAME\",\r\n\t\tCC.definition AS \"MAIN_TABLE_COLUMNS\",\r\n\t\t--'' AS \"=>\",\r\n\t\tNULL AS \"REFER_TABLE_SCHEMA\",\r\n\t\tNULL AS \"REFER_TABLE_NAME\",\r\n\t\tNULL AS \"REFER_TABLE_COLUMNS\",\r\n\t\t--$EndRegion: Get Check Constraints\r\n\t\t--'|' AS \"|||\",\r\n\t\t--$BeginRegion: Generate Check Constraint Drop Statements\r\n\t\t'IF OBJECT_ID(''' + QUOTENAME(OBJECT_SCHEMA_NAME(CC.object_id)) + '.' + QUOTENAME(CC.name) + ''', ''' + LTRIM(RTRIM(CC.type COLLATE DATABASE_DEFAULT)) + ''') IS NOT NULL'\r\n\t\t\t+ ' ALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME(CC.parent_object_id)) + '.' + QUOTENAME(OBJECT_NAME(CC.parent_object_id))\r\n\t\t\t+ ' DROP CONSTRAINT ' + QUOTENAME(CC.name) --QUOTENAME(OBJECT_NAME(CC.object_id))\r\n\t\t\t+ ';'\r\n\t\t\tAS \"DROP_CONSTRAINT_STATEMENT\",\r\n\t\t--$EndRegion: Generate Check Constraint Drop Statements\r\n\t\t--\r\n\t\t--$BeginRegion: Generate Check Constraint ReCreate Statements\r\n\t\t'IF OBJECT_ID(''' + QUOTENAME(OBJECT_SCHEMA_NAME(CC.object_id)) + '.' + QUOTENAME(CC.name) + ''', ''' + LTRIM(RTRIM(CC.type COLLATE DATABASE_DEFAULT)) + ''') IS NULL'\r\n\t\t\t+ ' BEGIN'\r\n\t\t\t\t+ ' ALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME(CC.parent_object_id)) + '.' + QUOTENAME(OBJECT_NAME(CC.parent_object_id)) + ' WITH NOCHECK'\r\n\t\t\t\t+ ' ADD CONSTRAINT ' + QUOTENAME(CC.name) --QUOTENAME(OBJECT_NAME(CC.object_id))\r\n\t\t\t\t+ ' CHECK (' + CC.definition + ')'\r\n\t\t\t\t+ ';'\r\n\t\t\t\t+ ' ALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME(CC.parent_object_id)) + '.' + QUOTENAME(OBJECT_NAME(CC.parent_object_id))\r\n\t\t\t\t+ ' CHECK CONSTRAINT ' + QUOTENAME(CC.name) --QUOTENAME(OBJECT_NAME(CC.object_id))\r\n\t\t\t\t+ ';'\r\n\t\t\t+ ' END'\r\n\t\t\t+ ';'\r\n\t\t\tAS \"RECREATE_CONSTRAINT_STATEMENT\"\r\n\t\t--$EndRegion: Generate Check Constraint ReCreate Statements\r\n\tFROM sys.check_constraints AS CC\r\n\tWHERE OBJECTPROPERTYEX(CC.parent_object_id, 'BaseType') = 'U'\r\n\t--$EndRegion: Check Constraints\r\n\tUNION ALL\r\n\t--$BeginRegion: ForeignKey Constraints\r\n\tSELECT --\r\n\t\t--$BeginRegion: Get ForeignKey Constraints\r\n\t\tFK.name AS CONSTRAINT_NAME,\r\n\t\tFK.type_desc AS CONSTRAINT_TYPE,\r\n\t\tFK.update_referential_action_desc AS \"ON_UPDATE?\",\r\n\t\tFK.delete_referential_action_desc AS \"ON_DELETE?\",\r\n\t\tCASE FK.is_disabled WHEN 0 THEN 'YES' ELSE 'NO' END AS \"IS_ENABLED?\",\r\n\t\tCASE FK.is_not_trusted WHEN 0 THEN 'YES' ELSE 'NO' END AS \"IS_TRUSTED?\",\r\n\t\t--'|' AS \"||\",\r\n\t\tOBJECT_SCHEMA_NAME(FK.parent_object_id) AS MAIN_TABLE_SCHEMA,\r\n\t\tOBJECT_NAME(FK.parent_object_id) AS MAIN_TABLE_NAME,\r\n\t\tSTUFF((SELECT ', ' + C.name\r\n\t\t\t\tFROM sys.columns AS C\r\n\t\t\t\tINNER JOIN sys.foreign_key_columns AS FKC ON C.object_id = FKC.parent_object_id AND C.column_id = FKC.parent_column_id\r\n\t\t\t\tWHERE FKC.constraint_object_id = FK.object_id\r\n\t\t\t\tORDER BY FKC.constraint_column_id FOR XML PATH('')), 1, 2, '') AS MAIN_TABLE_COLUMNS,\r\n\t\t--'' AS \"=>\",\r\n\t\tOBJECT_SCHEMA_NAME(FK.referenced_object_id) AS REFER_TABLE_SCHEMA,\r\n\t\tOBJECT_NAME(FK.referenced_object_id) AS REFER_TABLE_NAME,\r\n\t\tSTUFF((SELECT ', ' + C.name\r\n\t\t\t\tFROM sys.columns AS C\r\n\t\t\t\tINNER JOIN sys.foreign_key_columns AS FKC ON C.object_id = FKC.referenced_object_id AND C.column_id = FKC.referenced_column_id\r\n\t\t\t\tWHERE FKC.constraint_object_id = FK.object_id\r\n\t\t\t\tORDER BY FKC.constraint_column_id FOR XML PATH('')), 1, 2, '') AS REFER_TABLE_COLUMNS,\r\n\t\t--$EndRegion: Get ForeignKey Constraints\r\n\t\t--'|' AS \"|||\",\r\n\t\t--$BeginRegion: Generate ForeignKey Constraint Drop Statements\r\n\t\t'IF OBJECT_ID(''' + QUOTENAME(OBJECT_SCHEMA_NAME(FK.object_id)) + '.' + QUOTENAME(FK.name) + ''', ''' + FK.type COLLATE DATABASE_DEFAULT + ''') IS NOT NULL'\r\n\t\t\t+ ' ALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME(FK.parent_object_id)) + '.' + QUOTENAME(OBJECT_NAME(FK.parent_object_id))\r\n\t\t\t+ ' DROP CONSTRAINT ' + QUOTENAME(FK.name) --QUOTENAME(OBJECT_NAME(FK.object_id))\r\n\t\t\t+ ';' \r\n\t\t\tAS \"DROP_CONSTRAINT_STATEMENT\",\r\n\t\t--$EndRegion: Generate ForeignKey Constraint Drop Statements\r\n\t\t--\r\n\t\t--$BeginRegion: Generate ForeignKey Constraint ReCreate Statements\r\n\t\t'IF OBJECT_ID(''' + QUOTENAME(OBJECT_SCHEMA_NAME(FK.object_id)) + '.' + QUOTENAME(FK.name) + ''', ''' + FK.type COLLATE DATABASE_DEFAULT + ''') IS NULL'\r\n\t\t\t+ ' BEGIN'\r\n\t\t\t\t+ ' ALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME(FK.parent_object_id)) + '.' + QUOTENAME(OBJECT_NAME(FK.parent_object_id))\r\n\t\t\t\t+ ' WITH ' + CASE FK.is_not_trusted WHEN 0 THEN 'CHECK' ELSE 'NOCHECK' END\r\n\t\t\t\t+ ' ADD CONSTRAINT ' + QUOTENAME(FK.name) --QUOTENAME(OBJECT_NAME(FK.object_id))\r\n\t\t\t\t+ ' FOREIGN KEY'\r\n\t\t\t\t+ ' (' + STUFF((SELECT ', ' + QUOTENAME(C.name)\r\n\t\t\t\t\t\t\t\tFROM sys.columns AS C\r\n\t\t\t\t\t\t\t\tINNER JOIN sys.foreign_key_columns AS FKC ON C.object_id = FKC.parent_object_id AND C.column_id = FKC.parent_column_id\r\n\t\t\t\t\t\t\t\tWHERE FKC.constraint_object_id = FK.object_id\r\n\t\t\t\t\t\t\t\tORDER BY FKC.constraint_column_id FOR XML PATH('')), 1, 1, '') + ' )'\r\n\t\t\t\t+ ' REFERENCES ' + QUOTENAME(OBJECT_SCHEMA_NAME(FK.referenced_object_id)) + '.' + QUOTENAME(OBJECT_NAME(FK.referenced_object_id))\r\n\t\t\t\t+ ' (' + STUFF((SELECT ', ' + QUOTENAME(C.name)\r\n\t\t\t\t\t\t\t\tFROM sys.columns AS C\r\n\t\t\t\t\t\t\t\tINNER JOIN sys.foreign_key_columns AS FKC ON C.object_id = FKC.referenced_object_id AND C.column_id = FKC.referenced_column_id\r\n\t\t\t\t\t\t\t\tWHERE FKC.constraint_object_id = FK.object_id\r\n\t\t\t\t\t\t\t\tORDER BY FKC.constraint_column_id FOR XML PATH('')), 1, 1, '') + ' )'\r\n\t\t\t\t+ ' ON DELETE ' + CASE FK.delete_referential_action WHEN 1 THEN 'CASCADE' WHEN 2 THEN 'SET NULL' WHEN 3 THEN 'SET DEFAULT' ELSE 'NO ACTION' END\r\n\t\t\t\t+ ' ON UPDATE ' + CASE FK.update_referential_action WHEN 1 THEN 'CASCADE' WHEN 2 THEN 'SET NULL' WHEN 3 THEN 'SET DEFAULT' ELSE 'NO ACTION' END\r\n\t\t\t\t+ CASE FK.is_not_for_replication WHEN 0 THEN '' ELSE ' NOT FOR REPLICATION' END\r\n\t\t\t\t+ ';'\r\n\t\t\t\t+ ' ALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME(FK.parent_object_id)) + '.' + QUOTENAME(OBJECT_NAME(FK.parent_object_id))\r\n\t\t\t\t+ CASE FK.is_disabled WHEN 0 THEN ' CHECK' ELSE ' NOCHECK' END + ' CONSTRAINT ' + QUOTENAME(OBJECT_NAME(FK.object_id))\r\n\t\t\t\t+ ';'\r\n\t\t\t+ ' END'\r\n\t\t\t+ ';'\r\n\t\t\tAS \"RECREATE_CONSTRAINT_STATEMENT\"\r\n\t\t--$EndRegion: Generate ForeignKey Constraint ReCreate Statements\r\n\tFROM sys.foreign_keys AS FK\r\n\tWHERE OBJECTPROPERTYEX(FK.parent_object_id, 'BaseType') = 'U'\r\n\t--$EndRegion: ForeignKey Constraints\r\n)\r\nAS CTE\r\nWHERE 1 = 1\r\n\tAND (CONSTRAINT_NAME LIKE '%'+@ConstraintName+'%' OR @ConstraintName IS NULL)\r\n\tAND (CONSTRAINT_TYPE = @ConstraintType OR @ConstraintType IS NULL) -- IN ('PRIMARY_KEY_CONSTRAINT', 'FOREIGN_KEY_CONSTRAINT', 'UNIQUE_CONSTRAINT', 'CHECK_CONSTRAINT')\r\n\tAND ([ON_DELETE?] = @Ondelete OR @Ondelete IS NULL) -- IN ('NO_ACTION', 'CASCADE', 'SET_NULL', 'SET_DEFAULT')\r\n\tAND ([ON_UPDATE?] = @Onupdate OR @Onupdate IS NULL) -- IN ('NO_ACTION', 'CASCADE', 'SET_NULL', 'SET_DEFAULT')\r\n\tAND ([IS_ENABLED?] = @IsEnabled OR @IsEnabled IS NULL) -- IN ('YES', 'NO')\r\n\tAND ([IS_TRUSTED?] = @IsTrusted OR @IsTrusted IS NULL) -- IN ('YES', 'NO')\r\n\tAND (MAIN_TABLE_SCHEMA LIKE '%'+@MainTableSchema+'%' OR @MainTableSchema IS NULL)\r\n\tAND (MAIN_TABLE_NAME LIKE '%'+@MainTableName+'%' OR @MainTableName IS NULL)\r\n\tAND (MAIN_TABLE_COLUMNS LIKE '%'+@MainTableColumns+'%' OR @MainTableColumns IS NULL)\r\n\tAND (REFER_TABLE_SCHEMA LIKE '%'+@ReferTableSchema+'%' OR @ReferTableSchema IS NULL)\r\n\tAND (REFER_TABLE_NAME LIKE '%'+@ReferTableName+'%' OR @ReferTableName IS NULL)\r\n\tAND (REFER_TABLE_COLUMNS LIKE '%'+@ReferTableColumns+'%' OR @ReferTableColumns IS NULL);",
  "placeholders": [
    {
      "name": "ConstraintName",
      "defaultValue": " "
    },
    {
      "name": "ConstraintType",
      "defaultValue": " "
    },
    {
      "name": "MainTableSchema",
      "defaultValue": " "
    },
    {
      "name": "MainTableName",
      "defaultValue": " "
    },
    {
      "name": "MainTableColumns",
      "defaultValue": " "
    },
    {
      "name": "ReferTableSchema",
      "defaultValue": " "
    },
    {
      "name": "ReferTableName",
      "defaultValue": " "
    },
    {
      "name": "ReferTableColumns",
      "defaultValue": " "
    },
    {
      "name": "Ondelete",
      "defaultValue": " "
    },
    {
      "name": "Onupdate",
      "defaultValue": " "
    },
    {
      "name": "IsEnabled",
      "defaultValue": " "
    },
    {
      "name": "IsTrusted",
      "defaultValue": " "
    }
  ]
}