{
  "id": "20b2b005-8945-48e0-a7f3-1a2adea540f4",
  "prefix": "GenerateBackupRestoreScript",
  "description": "Generate Database Backup and Restore Script",
  "body": "USE master;\r\nGO\r\n--\r\nDECLARE @DBname VARCHAR(256) = '$DatabaseName$';\r\nDECLARE @BackupLocation VARCHAR(1024) = '$BackupFileLocation$';\r\n--\r\n/* == No Need to Change the Below Script ======================================================== */\r\nIF DB_ID(@DBname) IS NULL\r\nBEGIN\r\n\tRAISERROR('Database Does Not Exists, Please check the @DBname and Try Again...!', 16, 1);\r\n\tRETURN\r\nEND\r\n--\r\nDECLARE @BackupFileName VARCHAR(255) = @DBname + '_FullCopyOnly.bak';\r\nDECLARE @SQLcmd VARCHAR(MAX) = '';\r\n--\r\n--$BeginRegion: Backup Script Generation\r\nPRINT '/***** Backup Script for Database: ' + @DBname + ' *****/';\r\nSET @SQLcmd = 'USE [master];\r\nGO\r\nBACKUP DATABASE [' + @DBname + '] \r\nTO DISK = N''' + @BackupLocation + '\\' + @BackupFileName + '''\r\nWITH NAME = N''' + @DBname + '-Full Copy Only Database Backup'',\r\nCOPY_ONLY, NOFORMAT, INIT, SKIP, NOREWIND, NOUNLOAD, COMPRESSION, CHECKSUM, STATS = 5;\r\nGO\r\nRESTORE VERIFYONLY\r\nFROM DISK = N''' + @BackupLocation + '\\' + @BackupFileName + '''\r\nWITH NOUNLOAD, NOREWIND;\r\nGO';\r\nPRINT @SQLcmd;\r\n--$EndRegion: Backup Script Generation\r\nPRINT '';\r\n--$BeginRegion: Restore Script Generation\r\nPRINT '/***** Restore Script for Database: ' + @DBname + ' *****/';\r\nDECLARE @LogicalName VARCHAR(256), @PhysicalFileLocation VARCHAR(MAX);\r\n\r\nDECLARE DBFileCursor CURSOR FAST_FORWARD READ_ONLY LOCAL FOR\r\nSELECT name, physical_name\r\nFROM sys.master_files\r\nWHERE DB_NAME(database_id) = @DBname\r\nORDER BY type ASC, data_space_id ASC;\r\n\r\nOPEN DBFileCursor;\r\n\r\nFETCH NEXT FROM DBFileCursor INTO @LogicalName, @PhysicalFileLocation;\r\n\r\nPRINT 'USE [master];\r\nGO\r\nRESTORE DATABASE [' + @DBname + ']\r\nFROM DISK = N''' + @BackupLocation + '\\' + @BackupFileName + '''\r\nWITH ';\r\n\r\nWHILE @@FETCH_STATUS = 0\r\n\tBEGIN\r\n\t\tSET @SQLcmd = '\tMOVE N''' + @LogicalName + ''' TO N''' + @PhysicalFileLocation + ''',';\r\n\t\tPRINT @SQLcmd;\r\n\t\tFETCH NEXT FROM DBFileCursor INTO @LogicalName, @PhysicalFileLocation;\r\n\tEND;\r\n\r\nPRINT 'NOUNLOAD, REPLACE, STATS = 5;\r\nGO';\r\n\r\nCLOSE DBFileCursor;\r\nDEALLOCATE DBFileCursor;\r\n--$EndRegion: Restore Script Generation",
  "placeholders": [
    {
      "name": "DatabaseName",
      "defaultValue": null
    },
    {
      "name": "BackupFileLocation",
      "defaultValue": "C:\\SQLbackups"
    }
  ]
}