{
  "id": "3c60071a-b60c-45be-9031-30f90f326f80",
  "prefix": "ClearCache",
  "description": "Different Ways to Flush or Clear SQL Server Cache",
  "body": "/*DBCC DROPCLEANBUFFERS ( COMPUTE | ALL ) [ WITH NO_INFOMSGS ]*/\r\n--Used to test queries with a cold buffer cache without shutting down and restarting the server.\r\n--• WITH NO_INFOMSGS - Suppresses all informational messages. Informational messages are always suppressed on SQL Data Warehouse and Parallel Data Warehouse.\r\n--• COMPUTE - Purge the query plan cache from each Compute node.\r\n--• ALL - Purge the query plan cache from each Compute node and from the Control node. This is the default if you do not specify a value.\r\n--\r\n/*DBCC FREEPROCCACHE [ ( { plan_handle | sql_handle | pool_name } ) ] [ WITH NO_INFOMSGS ]*/\r\n--Used to clear the plan cache, a specific plan or a SQL Server resource pool.\r\n--• plan handle uniquely identifies a query plan for a batch that has executed and whose plan resides in the plan cache.\r\n----SELECT cp.plan_handle AS Plan_Handle FROM sys.dm_exec_cached_plans AS cp CROSS APPLY sys.dm_exec_sql_text(plan_handle) AS st WHERE OBJECT_NAME (st.objectid) LIKE '%TestProcedure%'\r\n--• sql_handle is the SQL handle of the batch to be cleared. sql_handle is varbinary(64).\r\n--• pool_name is the name of a Resource Governor resource pool.\r\n----SELECT name AS 'Pool_Name', cache_memory_kb/1024.0 AS [cache_memory_MB], used_memory_kb/1024.0 AS [used_memory_MB] FROM sys.dm_resource_governor_resource_pools;\r\n--\r\n/*DBCC FREESYSTEMCACHE( 'ALL' [, pool_name ] ) [WITH { [ MARK_IN_USE_FOR_REMOVAL ] , [ NO_INFOMSGS ]]*/\r\n--Releases all unused cache entries from all caches. You can use this command to manually remove unused entries from all caches or from a specific Resource Governor pool.\r\n--DBCC FREESYSTEMCACHE('ALL') WITH MARK_IN_USE_FOR_REMOVAL; --uses the MARK_IN_USE_FOR_REMOVAL clause to release entries from all current caches once the entries become unused.\r\n--DBCC FREESYSTEMCACHE('SQL Plans'); --Flushes the ad hoc and prepared plan cache for the entire server instance.\r\n--DBCC FREESYSTEMCACHE('SQL Plans', 'LimitedIOPool'); --Flushes the ad hoc and prepared plan cache for one resource pool.\r\n--DBCC FREESYSTEMCACHE('Temporary Tables & Table Variables'); --Clear all table variables and temp tables cached.\r\n--DBCC FREESYSTEMCACHE('userdatabase'); --Clear for a specific user database.\r\n--DBCC FREESYSTEMCACHE('tempdb'); --Remove the tempdb cache.\r\n\r\n--\r\nDBCC DROPCLEANBUFFERS;\r\nDBCC FREEPROCCACHE;\r\nDBCC FREESYSTEMCACHE ('ALL');"
}